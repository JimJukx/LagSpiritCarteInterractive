async function loadChapters() {
  try {

    // -----------------------------------------
    // ðŸ”¥ CORRECTION ICI :
    // URL ABSOLUE VERS LE FICHIER JSON DU PLUGIN
    // -----------------------------------------
    const res = await fetch(
      "/wp-content/plugins/lagspirit-carte/assets/chapters.json"
    );

    let data = await res.json();

    CHAPTERS = data.map((ch) => {
      const mode = ch.coverageMode || "distance";
      const maxD =
        typeof ch.maxDistanceKm === "number"
          ? ch.maxDistanceKm
          : MAX_DISTANCE_KM;
      const depts = Array.isArray(ch.departments) ? ch.departments : [];
      return {
        ...ch,
        coverageMode: mode,
        maxDistanceKm: maxD,
        departments: depts,
      };
    });

    await initChapters();
    renderChaptersList();
    await loadDepartments();

  } catch (e) {
    console.error("Erreur de chargement de chapters.json", e);
    alert("Impossible de charger la liste des chapitres (chapters.json).");
  }
}

loadChapters();
